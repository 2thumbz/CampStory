<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<!-- 인터페이스의 이름  -->
<mapper namespace="com.project.mybatis.JspBoardMapper">
	<!-- 메서드 이름 // 결과의 타입 : 결과를 저장할 데이터 타입 - DTO, String, Integer or Long -->
	<!--  <![CDATA[ 안쪽에있는 비교연산자를 괄호로 인식못하게 -->
	<select id="getList" resultType="com.project.bean.BoardDTO">
		<![CDATA[
		
		select num,writer,email,subject,passwd,reg_date,ref,re_step,re_level,content,ip,readcount,r 
		from (select num,writer,email,subject,passwd,reg_date,ref,re_step,re_level,content,ip,readcount,rownum r 
		from (select num,writer,email,subject,passwd,reg_date,ref,re_step,re_level,content,ip,readcount 
		from board order by ref desc, re_step asc) order by ref desc, re_step asc ) 
		where r >= #{startRow} and r <= #{endRow} 
		
  	   
		]]> 
	</select>
	
	<select id="getCount" resultType="int">
		<![CDATA[
		select count(*) from board 
		]]> 
	</select>
	
	<insert id="insert" parameterType="com.project.bean.BoardDTO">
		insert into board(num,writer,subject,email,content,passwd,ip,reg_date,ref,re_step,re_level)
		values(seq_board.nextval,#{writer},#{subject},#{email},#{content},#{passwd},#{ip},sysdate,#{ref},#{re_step},#{re_level})
	</insert>
	
	<select id="maxNum" resultType="int">
		select max(num) from board
	</select>
	<update id="stepUpdate">
		update board set re_step=re_step+1 where ref = #{ref} and re_step > #{re_step}
	
	</update>
	
	<!-- ? 가 하나밖에없을때 #{value}  -->
	<select id="read" resultType="com.project.bean.BoardDTO">
		select * from board where num=#{num}
	</select>
	
	<delete id="delete">
		delete board where num=#{num}
	</delete>
	
	<update id="update">
		update board set 
		writer=#{writer},
		subject =#{subject} ,
		email=#{email},
		content=#{content}, 
		passwd=#{passwd}
			where num=#{num}
	</update>
	
	<update id="readcount">
		update board set
		readcount = readcount+1
		where num=#{num}
	</update>
	
	<select id="passwdCheck" resultType="String">
		select passwd from board where num = #{num}		
	</select>
	
	
	
</mapper>